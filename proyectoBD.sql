-- MySQL Script generated by MySQL Workbench
-- Sun Jul 30 21:32:58 2023
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;


-- -----------------------------------------------------
-- Table `mydb`.`Inspector`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Inspector` (
  `id_Inspector` INT AUTO_INCREMENT NOT NULL,
  `Nombre` VARCHAR(20) NULL,
  `Email` VARCHAR(50) NULL,
  `Celular` VARCHAR(10) NULL,
  PRIMARY KEY (`id_Inspector`)
) 
ENGINE = InnoDB;
-- -----------------------------------------------------
-- Table `mydb`.`Cliente`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Cliente` (
  `id_Cliente` INT AUTO_INCREMENT NOT NULL,
  `Nombre` VARCHAR(20) NULL,
  `Apellido` VARCHAR(20) NULL,
  `Fecha_Nacimiento` DATE NULL,
  `Email` VARCHAR(50) NULL,
  `Celular` VARCHAR(10) NULL,
  `Edad` INT NULL,
  `Licencia` TINYINT NULL,
  `id_Inspector` INT NULL,
  PRIMARY KEY (`id_Cliente`),
  FOREIGN KEY (`id_inspector`) REFERENCES `mydb`.`Inspector` (`id_Inspector`) ON DELETE SET NULL
  )
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Pago`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Pago` (
  `Id_Pago` INT AUTO_INCREMENT NOT NULL,
  `Id_Cliente` INT NULL,
  `id_Devolucion` INT NULL,
  `Monto` FLOAT NULL,
  `Fecha` DATE NULL,
  `conf_pago` TINYINT NULL,
  `Plazo` DATE NULL,
  `Forma_pago` VARCHAR(20) NULL,
  PRIMARY KEY (`Id_Pago`),
  FOREIGN KEY (`Id_Cliente`) REFERENCES `mydb`.`Cliente` (`id_Cliente`) ON DELETE SET NULL,
  FOREIGN KEY (`id_Devolucion`) REFERENCES `mydb`.`Devolucion` (`id_Devolucion`) ON DELETE SET NULL
) 
ENGINE = InnoDB;





-- -----------------------------------------------------
-- Table `mydb`.`EmpresaAlquiler`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`EmpresaAlquiler` (
  `RUC` VARCHAR(10) NOT NULL,
  `Nombre` VARCHAR(50) NULL,
  PRIMARY KEY (`RUC`)
) 
ENGINE = InnoDB;



-- -----------------------------------------------------
-- Table `mydb`.`Vehiculo`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Vehiculo` (
  `No_Matricula` VARCHAR(7) NOT NULL,
  `RUC` VARCHAR(10) NULL,
  `Marca` VARCHAR(20) NULL,
  `Disponibilidad` TINYINT NULL,
  `Precio_alquiler` FLOAT NULL,
  `Capacidad` INT NULL,
  PRIMARY KEY (`No_Matricula`)
) 
ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `mydb`.`Reserva`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Reserva` (
  `id_Reserva` INT AUTO_INCREMENT NOT NULL,
  `Id_Cliente` INT NULL,
  `Id_Inspector` INT NULL,
  `No_Matricula` VARCHAR(7) NULL,
  `Fecha_Inicio` DATE NULL,
  `Hora_reserva` TIME NULL,
  `ubicacion_recogida` VARCHAR(50) NULL,
  PRIMARY KEY (`id_Reserva`),
  FOREIGN KEY (`Id_Cliente`) REFERENCES `mydb`.`Cliente` (`id_Cliente`) ON DELETE SET NULL,
  FOREIGN KEY (`Id_Inspector`) REFERENCES `mydb`.`Inspector` (`id_Inspector`) ON DELETE SET NULL,
  FOREIGN KEY (`No_Matricula`) REFERENCES `mydb`.`Vehiculo` (`No_Matricula`) ON DELETE SET NULL
) 
ENGINE = InnoDB;



-- -----------------------------------------------------
-- Table `mydb`.`Recargo`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Recargo` (
  `id_Recargo` INT AUTO_INCREMENT NOT NULL,
  `Id_pago` INT NULL,
  `Fecha` DATE NULL,
  `Cobertura_Seguro` VARCHAR(20) NULL,
  `Monto` FLOAT NULL,
  `Razon` VARCHAR(100) NULL,
  PRIMARY KEY (`id_Recargo`),
  FOREIGN KEY (`id_Pago`) REFERENCES `mydb`.`Pago` (`Id_Pago`) ON DELETE CASCADE
) 
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Devolucion`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Devolucion` (
  `id_Devolucion` INT AUTO_INCREMENT NOT NULL,
  `Id_Cliente` INT NULL,
  `No_Matricula` VARCHAR(7) NULL,
  `Estado_devolucion` TINYINT NULL,
  `Hora_devolucion` TIME NULL,
  `Hora_devolucion_real` TIME NULL,
  `Fecha_devolucion` DATE NULL,
  `Fecha_devolucion_real` DATE NULL,
  `Lugar_devolucion` VARCHAR(100) NULL,
  PRIMARY KEY (`id_Devolucion`),
  
  FOREIGN KEY (`No_Matricula`) REFERENCES `mydb`.`Vehiculo` (`No_Matricula`) ON DELETE SET NULL,
  FOREIGN KEY (`Id_Cliente`) REFERENCES `mydb`.`Cliente` (`Id_Cliente`) ON DELETE SET NULL
) 
ENGINE = InnoDB;




-- -----------------------------------------------------
-- Table `mydb`.`Alquilar`
-- Inspector_EmpresaAlquiler
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Alquilar` (
  `RUC` VARCHAR(10) NOT NULL,
  `id_Inspector` INT NOT NULL,
  PRIMARY KEY (`RUC`,`id_Inspector`),
  FOREIGN KEY (`RUC`) REFERENCES `mydb`.`EmpresaAlquiler` (`RUC`),
  FOREIGN KEY (`id_Inspector`) REFERENCES `mydb`.`Inspector` (`id_Inspector`)
) 
ENGINE = InnoDB;




-- -------------------------------------------------
-- Triggers
-- Establece automáticamente la fecha del Recargo
DELIMITER //
CREATE TRIGGER setRecargoDate
BEFORE INSERT ON Recargo
FOR EACH ROW
BEGIN
	SET NEW.Fecha = NOW();
END;
//
DELIMITER ;

-- Establece automáticamente la fecha del Pago
DELIMITER //
CREATE TRIGGER setPagoDate
BEFORE INSERT ON Pago
FOR EACH ROW
BEGIN
	SET NEW.Fecha = NOW();
END;
//
DELIMITER ;
-- Agrega tabla vihiculo
alter table vehiculo add imageURLVe varchar(300) default null;

-- Agrega tabla empresaAlquiler
alter table empresaalquiler add imageURLLogo varchar(300) default null;

-- Agrega tabla cliente
alter table cliente add imageURLFoto varchar(300) default null;

-- Agrega tabla inspector
alter table inspector add imageURLFotoin varchar(300) default null ;

-- Registros Inspectores
INSERT INTO Inspector (Nombre, Email, Celular) VALUES
('Javier', 'javier.inspector@gmail.com', '0998765432'),
('Carolina', 'carolina.inspector@hotmail.com', '0987654321'),
('Andres', 'andres.inspector@yahoo.com', '0998765432'),
('Patricia', 'patricia.inspector@outlook.com', '0987654321'),
('Fernando', 'fernando.inspector@gmail.com', '0998765432'),
('Diana', 'diana.inspector@hotmail.com', '0987654321'),
('Oscar', 'oscar.inspector@yahoo.com', '0998765432'),
('Camila', 'camila.inspector@gmail.com', '0987654321'),
('Carlos', 'carlos.inspector@outlook.com', '0998765432'),
('Sara', 'sara.inspector@yahoo.com', '0987654321');
-- ---------------
-- Registros Clientes
INSERT INTO Cliente (Nombre, Apellido, Fecha_Nacimiento, Email, Celular, Edad, Licencia,Id_Inspector) VALUES
('Juan', 'Perez', '1985-05-15', 'juan.perez@gmail.com', '0991234567', 36, 1,2),
('Maria', 'Gonzalez', '1990-09-22', 'maria.gonzalez@hotmail.com', '0987654321', 31, 1,4),
('Pedro', 'Ramirez', '1988-11-10', 'pedro.ramirez@yahoo.com', '0998765432', 33, 1,3),
('Ana', 'Lopez', '1995-03-03', 'ana.lopez@outlook.com', '0987654321', 26, 1,1),
('Carlos', 'Martinez', '1982-07-07', 'carlos.martinez@gmail.com', '0998765432', 39, 1,1),
('Laura', 'Sanchez', '1992-12-18', 'laura.sanchez@hotmail.com', '0987654321', 29, 1,6),
('Luis', 'Hernandez', '1987-02-25', 'luis.hernandez@yahoo.com', '0998765432', 34, 1,2),
('Paula', 'Torres', '1998-06-14', 'paula.torres@gmail.com', '0987654321', 23, 1,7),
('Roberto', 'Gomez', '1980-09-30', 'roberto.gomez@outlook.com', '0998765432', 41, 1,7),
('Sofia', 'Diaz', '1993-04-28', 'sofia.diaz@yahoo.com', '0987654321', 28, 1,7);

-- Registros Pagos
INSERT INTO Pago (Id_Cliente, id_Devolucion, Monto, Fecha, conf_pago, Plazo, Forma_pago) VALUES
(1, 1, 100.00, '2023-07-01', 0, '2023-08-01', 'Tarjeta'),
(2, 2, 150.50, '2023-07-15', 1, '2023-08-15', 'Efectivo'),
(3, 3, 200.00, '2023-07-02', 0, '2023-12-02', 'Tarjeta'),
(4, 4, 120.75, '2023-07-20', 4, '2023-08-20', 'Transferencia'),
(5, 5, 80.25, '2023-07-03', 1, '2023-08-03', 'Tarjeta'),
(6, 6, 300.00, '2023-07-25', 1, '2023-08-25', 'Efectivo'),
(3, 7, 90.00, '2023-07-10', 0, '2023-12-10', 'Tarjeta'),
(8, 8, 220.75, '2023-07-05', 0, '2023-08-05', 'Transferencia'),
(9, 9, 150.25, '2023-07-12', 1, '2023-08-12', 'Tarjeta');


-- Registros Empresa Alquiler
INSERT INTO EmpresaAlquiler (RUC, Nombre) VALUES
('3000000001', 'Alquiler de Autos Ecuador'),
('4000000002', 'Autos Rentables Cía. Ltda.'),
('5000000003', 'Carros Express S.A.'),
('6000000004', 'Rentacar Andino C.A.'),
('7000000005', 'CarrosVeloz Rentacar'),
('8000000006', 'RentautoEC Alquiler de Autos'),
('9000000007', 'Ecuarent Car Rental'),
('1000000008', 'Alquilautos S.A.'),
('2000000009', 'Velocar Rentacar'),
('3500000010', 'RentacarPremium Cía. Ltda.');
-- Registros Vehiculos
INSERT INTO Vehiculo (No_Matricula, RUC, Marca, Disponibilidad, Precio_alquiler, Capacidad) VALUES
('ABC123', '3000000001', 'Toyota', 1, 50.00, 4),
('XYZ789', '4000000002', 'Nissan', 1, 45.00, 5),
('DEF456', '5000000003', 'Chevrolet', 1, 60.00, 7),
('GHI987', '6000000004', 'Ford', 1, 55.00, 4),
('JKL234', '7000000005', 'Honda', 1, 48.00, 5),
('MNO345', '8000000006', 'Hyundai', 1, 52.00, 6),
('PQR567', '9000000007', 'Volkswagen', 1, 50.00, 4),
('STU890', '1000000008', 'Kia', 1, 47.00, 5),
('VWX901', '2000000009', 'Mazda', 1, 55.00, 6),
('YZA012', '3500000010', 'Suzuki', 1, 49.00, 5);


-- Registros Reservas
INSERT INTO Reserva (Id_Cliente, Id_Inspector, No_Matricula, Fecha_Inicio, Hora_reserva, ubicacion_recogida) VALUES
(1, 4, 'ABC123', '2023-07-01', '08:00:00', 'Quito, Aeropuerto Internacional Mariscal Sucre'),
(2, 4, 'XYZ789','2023-07-15', '09:30:00', 'Guayaquil, Centro Ciudad'),
(3, 4, 'YZA012','2023-07-02', '10:45:00', 'Cuenca, Terminal de Autobuses'),
(4, 4, 'JKL234','2023-07-20', '12:30:00', 'Riobamba, Terminal de Autobuses'),
(5, 4, 'MNO345','2023-07-03', '14:00:00', 'Manta, Aeropuerto Internacional Eloy Alfaro'),
(6, 4, 'ABC123','2023-07-25', '16:30:00', 'Guayaquil, Hotel Sheraton'),
(2, 4, 'DEF456','2023-07-04', '08:15:00', 'Quito, Aeropuerto Internacional Mariscal Sucre'),
(3, 4, 'DEF456','2023-07-10', '11:30:00', 'Guayaquil, Centro Ciudad'),
(8, 4, 'VWX901','2023-07-05', '13:00:00', 'Cuenca, Terminal de Autobuses'),
(9, 4, 'XYZ789','2023-07-12', '17:45:00', 'Riobamba, Hotel Montecarlo');


-- Registros Recargo
INSERT INTO Recargo (Id_pago, Fecha, Cobertura_Seguro, Monto, Razon) VALUES
(1, '2023-07-01', 'Seguro básico', 10.00, 'Cobertura adicional'),
(3,  '2023-07-15', 'Seguro completo', 15.50, 'Daño en el vehículo'),
(2, '2023-07-02', 'Seguro básico', 20.00, 'Demora en la entrega'),
(4, '2023-07-20', 'Seguro completo', 12.75, 'Daño en el parabrisas'),
(5, '2023-07-03', 'Seguro básico', 8.25, 'Demora en la devolución'),
(8, '2023-07-25', 'Seguro completo', 30.00, 'Choque delantero'),
(8, '2023-07-04', 'Seguro básico', 18.50, 'Choque trasero'),
(8, '2023-07-10', 'Seguro completo', 9.00, 'Rayón en la puerta derecha'),
(9, '2023-07-05', 'Seguro básico', 22.75, 'Demora en la entrega'),
(10, '2023-07-12', 'Seguro completo', 15.25, 'Daño en el retrovisor');


-- Registros Devoluciones
INSERT INTO Devolucion (Id_Cliente, No_Matricula, Estado_devolucion, Hora_devolucion, Hora_devolucion_real, Fecha_devolucion, Fecha_devolucion_real, Lugar_devolucion) VALUES
(1,'ABC123', 1, '17:00:00', null, '2023-08-01', null, 'Quito, Aeropuerto Internacional Mariscal Sucre'),
(2,'XYZ789', 1, '18:30:00', '19:00:00', '2023-08-15', '2023-08-15', 'Guayaquil, Centro Ciudad'),
(3,'DEF456', 1, '15:45:00', '16:00:00', '2023-08-02', '2023-08-02', 'Cuenca, Terminal de Autobuses'),
(4,'GHI987', 1, '16:30:00', null, '2023-08-20', null, 'Riobamba, Terminal de Autobuses'),
(5,'JKL234', 1, '14:30:00', '15:00:00', '2023-08-03', '2023-08-03', 'Manta, Aeropuerto Internacional Eloy Alfaro'),
(6,'ABC123', 1, '16:00:00', '16:30:00', '2023-08-25', '2023-08-25', 'Guayaquil, Hotel Sheraton'),
(3,'STU890', 1, '12:45:00', '13:15:00', '2023-08-10', '2023-08-10', 'Guayaquil, Centro Ciudad'),
(8,'VWX901', 1, '19:30:00', null, '2023-08-05', null, 'Cuenca, Terminal de Autobuses'),
(9,'YZA012', 1, '17:15:00', '17:45:00', '2023-08-12', '2023-08-12', 'Riobamba, Hotel Montecarlo');
